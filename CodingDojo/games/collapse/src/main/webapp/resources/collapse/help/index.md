<meta charset="UTF-8">

## Вступление

Игровой demo-сервер доступен так же в интернете 24/7 в целях
ознакомления [http://codenjoy.com/codenjoy-contest](http://codenjoy.com/codenjoy-contest).

Игра с открытым исходным кодом. Для реализации своей игры, исправления
ошибок в текущей и внесения других правок необходимо для начала
[форкнуть проект](https://github.com/codenjoyme/codenjoy.git).
В корне репозитория есть описание в файле Readme.md - там описано, что делать дальше.

По возникающим вопросам, пиши в [skype alexander.baglay](skype:alexander.baglay)
или на почту [apofig@gmail.com](mailto:apofig@gmail.com).

## В чем суть игры?

У каждого игрока есть свое поле с фишками. Все фишки разноцветные.
Игрок может обменять любые две соседние фишки местами.

Если за ход образуются области, заполненные одним цветом с фишками,
которые перемещались - игроку начисляются бонусные очки, а фишки
снимаются с поля (при этом верхние фишки под силой тяжести 
падают вниз, а на новом место образуются новые фишки случайным образом)

Очки начисляются следующим образом[(?)](#ask) - в зависимости 
от количества исчезнувших фишек:

* 2 фишки = `1+2` очков
* 3 фишки = `1+2+3` очков
* 4 фишки = `1+2+3+4` очков
* и так далее.

Очки суммируются. Побеждает игрок с большим числом очков (до условленного
времени).

[(?)](#ask)Точное количество очков за любое действие, а так же другие
настройки на данный момент игры уточни у Сенсея.

## Подключение к серверу

Итак, игрок [регистрируется на сервере](../../../register?gameName=collapse),
указывая свой email.

Далее необходимо подключиться из кода к серверу через websocket.
[Эта подборка](https://github.com/codenjoyme/codenjoy-clients.git)
клиентов для разных языков программирования тебе поможет в твоей игре.
Как запустить клиент смотри в корне проекта в файле README.md.

Если ты не можешь найти свой язык - придется написать свой клиент
(а после пошарить с нами на почту [apofig@gmail.com](mailto:apofig@gmail.com))

Адрес для подключения к игре на сервере выглядит так (ты можешь скопировать его
из игровой комнаты):

`https://[server]/codenjoy-contest/board/player/[user]?code=[code]`

Тут `[server]` - домен или ip-адрес игрового сервера, `[user]` - id игрока, a `[code]` -
твой security token. Убедись что код хранится в тайне, иначе любой участник
сможет играть от твоего имени.

В коде твоего клиента тебе нужно найти похожую строчку и заменить её твоим URL -
тем самым, ты задаёшь логин/пароль для доступа к серверу.
Затем запусти твой клиент и убедись, что сервер получает команды твоего клиента.
После этого можно приступать к работе над логикой бота.

## Формат сообщений

После подключения клиент будет регулярно (каждую секунду) получать строку
символов с закодированным состоянием поля. Формат таков:

`^board=(.*)$`

C помощью этого regexp можно выкусить строку доски.

## Пример поля

Вот пример строки от сервера:

<pre>board=☼☼☼☼☼☼☼☼☼☼2482852☼☼1367346☼☼6485683☼☼2127416☼☼4363253☼☼1854818☼☼7637564☼☼☼☼☼☼☼☼☼☼</pre>

Длинна строки равна площади поля `N*N`. Если вставить символ
переноса строки каждые `N=sqrt(length(string))` символов, то
получится читабельное изображение поля:

<pre>☼☼☼☼☼☼☼☼☼
☼2482852☼
☼1367346☼
☼6485683☼
☼2127416☼
☼4363253☼
☼1854818☼
☼7637564☼
☼☼☼☼☼☼☼☼☼</pre>

Первый символ строки соответствует ячейке расположенной в
левом верхнем углу и имеет координату `[0, 8]`.
Координата `[0, 0]` соответствует левому нижнему углу.
В этом примере — позиция ближайшей к левому нижнему углу 
фишки (символ `6`) — `[2, 1]`.

<pre>
 012345678
8☼☼☼☼☼☼☼☼☼
7☼       ☼
6☼       ☼
5☼       ☼
4☼       ☼
3☼       ☼
2☼       ☼
1☼       ☼
0☼☼☼☼☼☼☼☼☼</pre>

## Расшифровка символов

Расшифровку символов ты можешь [найти тут](elements.md).

## Как играть?

Игра пошаговая, каждую секунду сервер посылает твоему клиенту
состояние обновленного поля на текущий момент и ожидает
ответа команды. За следующую секунду игрок должен успеть дать 
команду для перемещения фишки. Если не успел — ничего на поле не изменится.

Твоя цель заставить фишки двигаться в соответствии с задуманным тобой алгоритмом.
Игрок на поле должен уметь зарабатывать так много очков, как только сможет.
Основная цель игры - обыграть по очкам всех соперников.

## Команды управления

Для изменения положения фишек на поле игроку необходимо послать команду 
`ACT(<X>,<Y>),<DIRECTION>`, где `X`, `Y` - координаты клетки, 
а `DIRECTION` - направление к соседней фишке (`LEFT`, `RIGHT`, `UP` 
или `DOWN`) с которой произойдет обмен.

## Настройки

Параметры будут меняться[(?)](#ask) по ходу игры.

## Кейзы

## <a id="ask"></a> Спроси Сенсея

Параметры могут изменяться по ходу игры. Настройки текущей игры
ты сможешь всегда [подглядеть тут](/codenjoy-contest/rest/settings/player).
Пожалуйста, спроси у Сенсея как интерпретировать эти данные. Ты можешь найти Сенсея
в чате, который подготовили организаторы для обсуждения вопросов.

## Подсказки

Первостепенная задача – написать websocket клиента, который подключится
к серверу. Затем заставить героя на поле слушаться команд.
Таким образом, игрок подготовится к основной игре.
Основная цель – вести осмысленную игру и победить.

Если ты не знаешь с чего начать, попробуй реализовать следующие алгоритмы:

* Переместить любую фишку в любом направлении.
* Найти на поле те области, перемещения рядом с которыми дают очки.
* Продумать более интересные многоходовые стратегии.

## Клиент и API

Организаторы предоставляют игрокам подготовленные клиенты в исходном 
коде на нескольких языках. Каждый из этих клиентов уже умеет связываться 
с сервером, принимать и разбирать сообщение от сервера (обычно это называется board)
и отправлять серверу команды.

Слишком много форы клиентский код не дает играющим, поскольку в этом коде
еще надо разобраться, но там реализована логика общения с сервером +
некоторое высокоуровневое API для работы с доской (что уже приятно).

Все языки так или иначе имеют похожий набор методов:

* `Solver`
  Пустой класс с одним методом — ты должен(должна) наполнить его умной логикой.
* `Direcion`
  Возможные направления движения для этой игры.
* `Point`
  `x`, `y` координаты.
* `Element`
  Тип элемента на доске.
* `Board` 
  Содержит логику для удобного поиска и манипуляции элементами на поле.
  Ты можешь найти следующие методы в Board классе:
* `int boardSize();`
  Размер доски.
* `boolean isAt(Point point, Element element);`
  Находится ли в позиции point заданный элемент?
* `boolean isAt(Point point, Collection<Element>elements);`
  Находится ли в позиции point что-нибудь из заданного набора?
* `boolean isNear(Point point, Element element);`
  Есть ли вокруг клеточки с координатой point заданный элемент?
* `int countNear(Point point, Element element);`
  Сколько элементов заданного типа есть вокруг клетки с point?
* `Element getAt(Point point);`
  Элемент в текущей клетке. 

## Как провести такой же ивент самостоятельно?

Перед тобой opensource проект. Для реализации своей новой игры, модификации этой игры,
любой другой модификации сервера или исправления найденной ошибки
[форкни проект](https://github.com/codenjoyme/codenjoy.git).
Все инструкции ты найдешь в Readme.md файлах - они подскажут, что делать дальше.

Если у тебя есть вопросы - прошу, задавай их мне
в [скайпе alexander.baglay](skype:alexander.baglay)
или по почте [apofig@gmail.com](mailto:apofig@gmail.com).

Удачной игры и пусть победит сильнейший! 